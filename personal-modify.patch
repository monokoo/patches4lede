--- a/feeds/packages/net/aria2/files/aria2.conf	2018-01-18 17:47:24.220368073 +0800
+++ b/feeds/packages/net/aria2/files/aria2.conf	2018-05-29 14:19:17.631214708 +0800
@@ -8,15 +8,30 @@
 # You can also add new config sections to define multi instance.
 #
 config aria2 'main'
-	option enabled '0'
 	option user 'aria2'
-	option dir '/mnt/sda1/aria2'
-	option config_dir '/var/etc/aria2'
+	option rpc_auth_method 'none'
+	option enable_log 'false'
+	list extra_settings 'seed-ratio=0'
+	list extra_settings 'force-save=true'
+	list extra_settings 'bt-hash-check-seed=true'
+	list extra_settings 'bt-seed-unverified=true'
+	list extra_settings 'bt-save-metadata=true'
+	list extra_settings 'enable-peer-exchange=false'
+	option disk_cache '64M'
+	option user_agent 'uTorrent/3420(32126)'
+	option bt_max_peers '96'
+	option peer_id_prefix '-UT3420-'
+	option enable_dht 'true'
 	option bt_enable_lpd 'true'
-	option enable_dht 'true'
-	option follow_torrent 'true'
+	option save_session_interval '30'
+	option enabled '0'
+	option min_split_size '20M'
+	option max_concurrent_downloads '5'
+	option max_connection_per_server '16'
+	option split '5'
+	option config_dir '/etc/aria2'
+	option listen_port '36279'
 	option file_allocation 'none'
-	option save_session_interval '30'
 
 	# Add addition Headers here.
 	# eg. list header 'Content-Encoding: gzip'
--- a/feeds/luci/modules/luci-mod-system/luasrc/controller/admin/system.lua	2018-05-14 16:33:04.495992860 +0800
--- b/feeds/luci/modules/luci-mod-system/luasrc/controller/admin/system.lua 2018-05-29 14:33:52.519290194 +0800
@@ -18,6 +18,10 @@
 		entry({"admin", "system", "packages", "ipkg"}, form("admin_system/ipkg"))
 	end
 
+	if fs.access("/usr/sbin/shellinaboxd")then
+		entry({"admin","system","WebShell"},template("admin_system/webshell"),_("WebShell"),11)
+	end
+
 	entry({"admin", "system", "startup"}, form("admin_system/startup"), _("Startup"), 45)
 	entry({"admin", "system", "crontab"}, form("admin_system/crontab"), _("Scheduled Tasks"), 46)
 
@@ -32,6 +36,7 @@
 		entry({"admin", "system", "leds"}, cbi("admin_system/leds"), _("<abbr title=\"Light Emitting Diode\">LED</abbr> Configuration"), 60)
 	end
 
+	entry({"admin", "system", "Free_Memory"},call("Free_Memory"),_("Free Memory"),65)
 	entry({"admin", "system", "flashops"}, call("action_flashops"), _("Backup / Flash Firmware"), 70)
 	entry({"admin", "system", "flashops", "reset"}, post("action_reset"))
 	entry({"admin", "system", "flashops", "backup"}, post("action_backup"))
@@ -45,6 +50,11 @@
 	entry({"admin", "system", "reboot", "call"}, post("action_reboot"))
 end
 
+function Free_Memory()
+	luci.util.exec("echo 3 > /proc/sys/vm/drop_caches")
+	luci.http.redirect(luci.dispatcher.build_url("admin","status","overview"))
+end
+
 function action_clock_status()
 	local set = tonumber(luci.http.formvalue("set"))
 	if set ~= nil and set > 0 then
--- a/feeds/luci/applications/luci-app-wol/luasrc/model/cbi/wol.lua	2018-05-29 14:43:21.042652545 +0800
--- b/feeds/luci/applications/luci-app-wol/luasrc/model/cbi/wol.lua 2018-05-29 14:41:40.615037357 +0800
@@ -71,7 +71,7 @@
 			local iface = luci.http.formvalue("cbid.wol.1.iface")
 			local broadcast = luci.http.formvalue("cbid.wol.1.broadcast")
 			cmd = "%s -D%s %s %q 2>&1" %{
-				util, (iface ~= "" and " -i %s" % utl.shellquote(iface) or ""),
+				util, (iface ~= "" and " -i %s" % utl.shellquote(iface) or " -i br-lan"),
 				(broadcast == "1" and " -b" or ""), mac
 			}
 		else
diff --git a/package/base-files/files/etc/rc.button/reset b/package/base-files/files/etc/rc.button/reset
index 2403122ad2..5746ea237a 100755
--- a/package/base-files/files/etc/rc.button/reset
+++ b/package/base-files/files/etc/rc.button/reset
@@ -15,16 +15,8 @@ timeout)
 	set_state failsafe
 ;;
 released)
-	if [ "$SEEN" -lt 1 ]
-	then
-		echo "REBOOT" > /dev/console
-		sync
-		reboot
-	elif [ "$SEEN" -ge 5 -a -n "$OVERLAY" ]
-	then
 		echo "FACTORY RESET" > /dev/console
 		jffs2reset -y && reboot &
-	fi
 ;;
 esac
 
diff --git a/package/network/ipv6/6in4/files/6in4.sh b/package/network/ipv6/6in4/files/6in4.sh
index 941dc43d68..ba65dfe979 100755
--- a/package/network/ipv6/6in4/files/6in4.sh
+++ b/package/network/ipv6/6in4/files/6in4.sh
@@ -11,7 +11,7 @@
 
 proto_6in4_update() {
 	sh -c '
-		timeout=5
+		timeout=8
 
 		(while [ $((timeout--)) -gt 0 ]; do
 			sleep 1
diff --git a/package/network/services/hostapd/files/hostapd.sh b/package/network/services/hostapd/files/hostapd.sh
index 7ffff4e7e1..c55f05c9b3 100644
--- a/package/network/services/hostapd/files/hostapd.sh
+++ b/package/network/services/hostapd/files/hostapd.sh
@@ -383,6 +383,11 @@ hostapd_set_bss_options() {
 		set_default wps_manufacturer "www.openwrt.org"
 		set_default wps_independent 1
 
+		# Set WPS label pin to original Netgear value stored in art partition
+		# Value for wps_pin can be overridden by /etc/config/wireless
+#		local PINdefault="$(dd if=/dev/mtdblock3 bs=1 skip=18 count=8 2>/dev/null)"
+#		set_default wps_pin "$PINdefault"
+
 		wps_state=2
 		[ -n "$wps_configured" ] && wps_state=1
 
diff --git a/package/network/services/hostapd/files/wps-hotplug.sh b/package/network/services/hostapd/files/wps-hotplug.sh
index 24af80e55b..1b7eda42c8 100644
--- a/package/network/services/hostapd/files/wps-hotplug.sh
+++ b/package/network/services/hostapd/files/wps-hotplug.sh
@@ -1,11 +1,16 @@
 #!/bin/sh
 
 if [ "$ACTION" = "pressed" -a "$BUTTON" = "wps" ]; then
+	logger "WPS button pressed, looking for active radios"
+	echo "timer" > /sys/class/leds/r7800:white:wps/trigger
 	cd /var/run/hostapd
 	for socket in *; do
 		[ -S "$socket" ] || continue
+		logger "WPS activated for: $socket"
 		hostapd_cli -i "$socket" wps_pbc
 	done
+	sleep 120
+	echo "none" > /sys/class/leds/r7800:white:wps/trigger
 fi
 
 return 0
diff --git a/package/network/services/odhcpd/files/odhcpd-update b/package/network/services/odhcpd/files/odhcpd-update
index 9bc7abcc1c..d11771755d 100755
--- a/package/network/services/odhcpd/files/odhcpd-update
+++ b/package/network/services/odhcpd/files/odhcpd-update
@@ -1,6 +1,8 @@
 #!/bin/sh
 # Make dnsmasq reread hostfile by sending SIGHUP signal
 
+logger -t odhcpd "*** ODHCPD triggers DNSMASQ reload ***"
+
 . $IPKG_INSTROOT/lib/functions/procd.sh
 
 procd_send_signal dnsmasq
diff --git a/feeds/packages/net/nlbwmon/files/nlbwmon.init b/feeds/packages/net/nlbwmon/files/nlbwmon.init
index 3f01d0f5..993e9d6c 100755
--- a/feeds/packages/net/nlbwmon/files/nlbwmon.init
+++ b/feeds/packages/net/nlbwmon/files/nlbwmon.init
@@ -1,6 +1,6 @@
 #!/bin/sh /etc/rc.common
 
-START=60
+START=85
 
 USE_PROCD=1
 NAME=nlbwmon
--- a/feeds/luci/applications/luci-app-ntpc/luasrc/model/cbi/ntpc/ntpc.lua	2018-05-29 20:35:31.578206766 +0800
+++ b/feeds/luci/applications/luci-app-ntpc/luasrc/model/cbi/ntpc/ntpc.lua	2017-09-19 21:37:28.000000000 +0800
@@ -23,7 +23,7 @@
 s2.addremove = false
 
 freq = s2:option(Value, "freq", translate("Offset frequency"))
-freq.datatype = "integer"
+freq.datatype = "uinteger"
 freq.rmempty = true
 
 s3 = m:section(TypedSection, "ntpserver", translate("Time Servers"))
--- a/feeds/luci/applications/luci-app-minidlna/Makefile	2018-05-29 21:35:26.704957690 +0800
+++ b/feeds/luci/applications/luci-app-minidlna/Makefile	2017-08-20 20:35:50.000000000 +0800
@@ -7,7 +7,7 @@
 include $(TOPDIR)/rules.mk
 
 LUCI_TITLE:=LuCI Support for miniDLNA
-LUCI_DEPENDS:=+minidlna
+LUCI_DEPENDS:=+minidlna-dsd
 
 include ../../luci.mk
 
--- a/feeds/luci/modules/luci-base/luasrc/view/sysauth.htm	2018-05-29 20:35:31.582208947 +0800
+++ b/feeds/luci/modules/luci-base/luasrc/view/sysauth.htm	2017-08-20 20:35:50.000000000 +0800
@@ -6,7 +6,7 @@
 
 <%+header%>
 
-<form method="post" action="<%=pcdata(FULL_REQUEST_URI)%>">
+<form method="post" action="<%=pcdata(luci.http.getenv("REQUEST_URI"))%>">
 	<%- if fuser then %>
 	<div class="errorbox"><%:Invalid username and/or password! Please try again.%></div>
 	<% end -%>
@@ -48,6 +48,7 @@
 local fs  = require "nixio.fs"
 local https_key = uci:get("uhttpd", "main", "key")
 local https_port = uci:get("uhttpd", "main", "listen_https")
+local https_redirect = uci:get("uhttpd", "main", "redirect_https") or '0'	
 if type(https_port) == "table" then
 	https_port = https_port[1]
 end
@@ -57,7 +58,7 @@
 %>
 
 <script type="text/javascript">//<![CDATA[
-	if (document.location.protocol != 'https:') {
+	if (document.location.protocol != 'https:' && '<%=https_redirect%>' == '1') {
 		var url = 'https://' + window.location.hostname + ':' + '<%=https_port%>' + window.location.pathname;
 		var img=new Image;
 		img.onload=function(){window.location = url};
--- a/feeds/luci/modules/luci-base/root/etc/config/luci	2018-05-29 20:35:31.778315847 +0800
+++ b/feeds/luci/modules/luci-base/root/etc/config/luci	2018-05-29 21:42:33.672669069 +0800
@@ -1,6 +1,6 @@
 config core main
-	option lang auto
-	option mediaurlbase /luci-static/bootstrap
+	option lang zh_cn
+	option mediaurlbase /luci-static/atmaterial
 	option resourcebase /luci-static/resources
 	
 config extern flash_keep
@@ -22,6 +22,10 @@
 	option enable 1
 		
 config internal themes
+	option Bootstrap '/luci-static/bootstrap'
+	option Material '/luci-static/material'
+	option ADVancedtomato '/luci-static/advancedtomato'
+	option ATMaterial '/luci-static/atmaterial'
 
 config internal apply
 	option rollback 30
--- a/feeds/luci/protocols/luci-proto-ppp/luasrc/model/cbi/admin_network/proto_pppoe.lua	2018-05-29 20:35:31.826342026 +0800
+++ b/feeds/luci/protocols/luci-proto-ppp/luasrc/model/cbi/admin_network/proto_pppoe.lua	2017-09-05 10:27:10.000000000 +0800
@@ -121,6 +121,8 @@
 demand.placeholder = "0"
 demand.datatype    = "uinteger"
 
+local u=net:get_interface()
+luci.tools.proto.opt_macaddr(section,u,translate("Override MAC address"))
 
 mtu = section:taboption("advanced", Value, "mtu", translate("Override MTU"))
 mtu.placeholder = "1500"
diff -urN a/feeds/luci/applications/luci-app-nlbwmon/luasrc/controller/nlbw.lua b/feeds/luci/applications/luci-app-nlbwmon/luasrc/controller/nlbw.lua
--- a/feeds/luci/applications/luci-app-nlbwmon/luasrc/controller/nlbw.lua	2018-05-29 20:35:31.574204584 +0800
+++ b/feeds/luci/applications/luci-app-nlbwmon/luasrc/controller/nlbw.lua	2018-05-29 22:01:30.112122373 +0800
@@ -4,16 +4,16 @@
 module("luci.controller.nlbw", package.seeall)
 
 function index()
-	entry({"admin", "nlbw"}, firstchild(), _("Bandwidth Monitor"), 80)
-	entry({"admin", "nlbw", "display"}, template("nlbw/display"), _("Display"), 1)
-	entry({"admin", "nlbw", "config"}, cbi("nlbw/config"), _("Configuration"), 2)
-	entry({"admin", "nlbw", "backup"}, template("nlbw/backup"), _("Backup"), 3)
-	entry({"admin", "nlbw", "data"}, call("action_data"), nil, 4)
-	entry({"admin", "nlbw", "list"}, call("action_list"), nil, 5)
-	entry({"admin", "nlbw", "ptr"}, call("action_ptr"), nil, 6).leaf = true
-	entry({"admin", "nlbw", "download"}, call("action_download"), nil, 7)
-	entry({"admin", "nlbw", "restore"}, post("action_restore"), nil, 8)
-	entry({"admin", "nlbw", "commit"}, call("action_commit"), nil, 9)
+	entry({"admin", "status", "nlbw"}, firstchild(), _("Bandwidth Monitor"), 80)
+	entry({"admin", "status", "nlbw", "display"}, template("nlbw/display"), _("Display"), 1)
+	entry({"admin", "status", "nlbw", "config"}, cbi("nlbw/config"), _("Configuration"), 2)
+	entry({"admin", "status", "nlbw", "backup"}, template("nlbw/backup"), _("Backup"), 3)
+	entry({"admin", "status", "nlbw", "data"}, call("action_data"), nil, 4)
+	entry({"admin", "status", "nlbw", "list"}, call("action_list"), nil, 5)
+	entry({"admin", "status", "nlbw", "ptr"}, call("action_ptr"), nil, 6).leaf = true
+	entry({"admin", "status", "nlbw", "download"}, call("action_download"), nil, 7)
+	entry({"admin", "status", "nlbw", "restore"}, post("action_restore"), nil, 8)
+	entry({"admin", "status", "nlbw", "commit"}, call("action_commit"), nil, 9)
 end
 
 local function exec(cmd, args, writer)
@@ -224,6 +224,6 @@
 	local http = require "luci.http"
 	local disp = require "luci.dispatcher"
 
-	http.redirect(disp.build_url("admin/nlbw/display"))
+	http.redirect(disp.build_url("admin/status/nlbw/display"))
 	exec("/usr/sbin/nlbw", { "-c", "commit" })
 end
diff -urN a/feeds/luci/applications/luci-app-nlbwmon/luasrc/model/cbi/nlbw/config.lua b/feeds/luci/applications/luci-app-nlbwmon/luasrc/model/cbi/nlbw/config.lua
--- a/feeds/luci/applications/luci-app-nlbwmon/luasrc/model/cbi/nlbw/config.lua	2018-05-29 20:35:31.574204584 +0800
+++ b/feeds/luci/applications/luci-app-nlbwmon/luasrc/model/cbi/nlbw/config.lua	2018-05-29 22:06:38.770029539 +0800
@@ -49,7 +49,7 @@
 
 
 warning = s:taboption("general", DummyValue, "_warning", translate("Warning"))
-warning.default = translatef("Changing the accounting interval type will invalidate existing databases!<br /><strong><a href=\"%s\">Download backup</a></strong>.", luci.dispatcher.build_url("admin/nlbw/backup"))
+warning.default = translatef("Changing the accounting interval type will invalidate existing databases!<br /><strong><a href=\"%s\">Download backup</a></strong>.", luci.dispatcher.build_url("admin/status/nlbw/backup"))
 warning.rawhtml = true
 
 if (m.uci:get_first("nlbwmon", "nlbwmon", "database_interval") or ""):match("^%d%d%d%d-%d%d-%d%d/%d+$") then
diff -urN a/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/backup.htm b/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/backup.htm
--- a/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/backup.htm	2018-05-29 20:35:31.574204584 +0800
+++ b/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/backup.htm	2018-05-29 22:03:24.521129138 +0800
@@ -11,7 +11,7 @@
 <fieldset class="cbi-section">
 	<legend><%:Restore Database Backup%></legend>
 	<p>
-		<form method="POST" action="<%=url("admin/nlbw/restore")%>" enctype="multipart/form-data">
+		<form method="POST" action="<%=url("admin/status/nlbw/restore")%>" enctype="multipart/form-data">
 			<input type="hidden" name="token" value="<%=token%>" />
 			<input type="file" name="archive" accept="application/gzip,.gz" />
 			<input type="submit" value="<%:Restore%>" class="cbi-button cbi-button-apply" />
@@ -24,7 +24,7 @@
 
 	<legend><%:Download Database Backup%></legend>
 	<p>
-		<form method="GET" action="<%=url("admin/nlbw/download")%>">
+		<form method="GET" action="<%=url("admin/status/nlbw/download")%>">
 			<input type="submit" value="<%:Generate Backup%>" class="cbi-button cbi-button-link" />
 		</form>
 	</p>
diff -urN a/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/display.htm b/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/display.htm
--- a/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/display.htm	2018-05-29 20:35:31.574204584 +0800
+++ b/feeds/luci/applications/luci-app-nlbwmon/luasrc/view/nlbw/display.htm	2018-05-29 22:05:11.127803790 +0800
@@ -394,7 +394,7 @@
 
 function fetchData(period)
 {
-	XHR.get('<%=url("admin/nlbw/data")%>', { period: period, group_by: 'family,mac,ip,layer7', order_by: '-rx_bytes,-tx_bytes' }, function(xhr, res) {
+	XHR.get('<%=url("admin/status/nlbw/data")%>', { period: period, group_by: 'family,mac,ip,layer7', order_by: '-rx_bytes,-tx_bytes' }, function(xhr, res) {
 		if (res !== null && typeof(res) === 'object' && typeof(res.columns) === 'object' && typeof(res.data) === 'object')
 			trafficData = res;
 
@@ -409,7 +409,7 @@
 		renderLayer7Data();
 		renderIPv6Data();
 
-		XHR.get('<%=url("admin/nlbw/ptr")%>/' + ipAddrs.join('/'), null, function(xhr, res) {
+		XHR.get('<%=url("admin/status/nlbw/ptr")%>/' + ipAddrs.join('/'), null, function(xhr, res) {
 			if (res !== null && typeof(res) === 'object')
 				hostNames = res;
 		});
@@ -633,7 +633,7 @@
 		var cell = table.insertRow(-1).insertCell(-1);
 
 		cell.setAttribute('colspan', 6);
-		cell.innerHTML = '<em><%:No data recorded yet.%> <a href="<%=url("admin/nlbw/commit")%>"><%:Force reload…%></a></em>';
+		cell.innerHTML = '<em><%:No data recorded yet.%> <a href="<%=url("admin/status/nlbw/commit")%>"><%:Force reload…%></a></em>';
 	}
 
 	pie('traf-pie', trafData);
@@ -693,7 +693,7 @@
 		var cell = table.insertRow(-1).insertCell(-1);
 
 		cell.setAttribute('colspan', 6);
-		cell.innerHTML = '<em><%:No data recorded yet.%> <a href="<%=url("admin/nlbw/commit")%>"><%:Force reload…%></a></em>';
+		cell.innerHTML = '<em><%:No data recorded yet.%> <a href="<%=url("admin/status/nlbw/commit")%>"><%:Force reload…%></a></em>';
 	}
 
 	pie('layer7-rx-pie', rxData);
@@ -811,7 +811,7 @@
 		var cell = table.insertRow(-1).insertCell(-1);
 
 		cell.setAttribute('colspan', 7);
-		cell.innerHTML = '<em><%:No data recorded yet.%> <a href="<%=url("admin/nlbw/commit")%>"><%:Force reload…%></a></em>';
+		cell.innerHTML = '<em><%:No data recorded yet.%> <a href="<%=url("admin/status/nlbw/commit")%>"><%:Force reload…%></a></em>';
 	}
 
 	var shareData = [], hostsData = [];
@@ -1012,10 +1012,10 @@
 
 <div class="cbi-section" id="container.nlbw.export" style="display:none">
 	<ul>
-		<li><a href="<%=url('admin/nlbw/data')%>?type=csv&#38;group_by=mac&#38;order_by=-rx,-tx"><%:CSV, grouped by MAC%></a></li>
-		<li><a href="<%=url('admin/nlbw/data')%>?type=csv&#38;group_by=ip&#38;order_by=-rx,-tx"><%:CSV, grouped by IP%></a></li>
-		<li><a href="<%=url('admin/nlbw/data')%>?type=csv&#38;group_by=layer7&#38;order_by=-rx,-tx"><%:CSV, grouped by protocol%></a></li>
-		<li><a href="<%=url('admin/nlbw/data')%>?type=json"><%:JSON dump%></a></li>
+		<li><a href="<%=url('admin/status/nlbw/data')%>?type=csv&#38;group_by=mac&#38;order_by=-rx,-tx"><%:CSV, grouped by MAC%></a></li>
+		<li><a href="<%=url('admin/status/nlbw/data')%>?type=csv&#38;group_by=ip&#38;order_by=-rx,-tx"><%:CSV, grouped by IP%></a></li>
+		<li><a href="<%=url('admin/status/nlbw/data')%>?type=csv&#38;group_by=layer7&#38;order_by=-rx,-tx"><%:CSV, grouped by protocol%></a></li>
+		<li><a href="<%=url('admin/status/nlbw/data')%>?type=json"><%:JSON dump%></a></li>
 	</ul>
 </div>
 
@@ -1025,7 +1025,7 @@
 	cbi_t_add('nlbw', 'ipv6');
 	cbi_t_add('nlbw', 'export');
 
-	XHR.get('<%=url("admin/nlbw/list")%>', null, function(xhr, res) {
+	XHR.get('<%=url("admin/status/nlbw/list")%>', null, function(xhr, res) {
 
 		if (res !== null && typeof(res) === 'object' && res.length > 0) {
 			trafficPeriods = res;
--- a/feeds/packages/net/haproxy/Makefile	2018-06-18 11:06:39.932743333 +0800
+++ b/feeds/packages/net/haproxy/Makefile	2018-06-18 11:09:18.511537824 +0800
@@ -164,14 +164,8 @@
 endef
 
 define Package/haproxy/install
-	$(INSTALL_DIR) $(1)/usr/sbin
-	$(INSTALL_BIN) $(PKG_BUILD_DIR)/haproxy $(1)/usr/sbin/
-	$(INSTALL_DIR) $(1)/etc
-	$(INSTALL_CONF) ./files/haproxy.cfg $(1)/etc/
-	$(INSTALL_DIR) $(1)/etc/init.d
-	$(INSTALL_BIN) ./files/haproxy.init $(1)/etc/init.d/haproxy
-	$(INSTALL_DIR) $(1)/etc/hotplug.d/net
-	$(INSTALL_BIN) ./files/haproxy.hotplug $(1)/etc/hotplug.d/net/90-haproxy
+	$(INSTALL_DIR) $(1)/usr/bin
+	$(INSTALL_BIN) $(PKG_BUILD_DIR)/haproxy $(1)/usr/bin/
 endef
 
 Package/haproxy-nossl/install = $(Package/haproxy/install)
--- a/package/system/procd/files/procd.sh	2018-06-18 17:24:32.623016967 +0800
+++ b/package/system/procd/files/procd.sh	2018-06-23 21:48:05.454991747 +0800
@@ -61,7 +61,7 @@
 }
 
 _procd_wrapper() {
-	procd_lock
+	#procd_lock
 	while [ -n "$1" ]; do
 		eval "$1() { _procd_call _$1 \"\$@\"; }"
 		shift
--- a/feeds/luci/modules/luci-mod-status/luasrc/view/admin_status/index.htm	2018-06-30 21:40:49.329839320 +0800
+++ b/feeds/luci/modules/luci-mod-status/luasrc/view/admin_status/index.htm	2018-07-02 21:22:54.057940711 +0800
@@ -53,6 +53,7 @@
 			swap       = swapinfo,
 			connmax    = conn_max,
 			conncount  = conn_count,
+			temperature= luci.sys.exec("cat /sys/class/thermal/thermal_zone0/temp"),
 			wifinets   = stat.wifi_networks()
 		}
 
@@ -350,6 +351,9 @@
 					info.loadavg[2] / 65535.0
 				);
 
+			if (e = document.getElementById('temperature'))
+				e.innerHTML = String.format('%.2f\℃' ,info.temperature / 1000);
+			
 			if (e = document.getElementById('memtotal'))
 				e.innerHTML = progressbar(
 					((info.memory.free + info.memory.buffered) / 1024) + " <%:kB%>",
@@ -401,6 +404,7 @@
 			<%=pcdata(ver.luciname)%> (<%=pcdata(ver.luciversion)%>)
 		</div></div>
 		<div class="tr"><div class="td left" width="33%"><%:Kernel Version%></div><div class="td left"><%=unameinfo.release or "?"%></div></div>
+		<div class="tr"><div class="td left" width="33%"><%:CPU Temperature%></div><div class="td left" id="temperature">-</div></div>
 		<div class="tr"><div class="td left" width="33%"><%:Local Time%></div><div class="td left" id="localtime">-</div></div>
 		<div class="tr"><div class="td left" width="33%"><%:Uptime%></div><div class="td left" id="uptime">-</div></div>
 		<div class="tr"><div class="td left" width="33%"><%:Load Average%></div><div class="td left" id="loadavg">-</div></div>
--- a/feeds/luci/modules/luci-base/luasrc/view/cbi/apply_widget.htm	2018-06-30 21:40:49.305839500 +0800
+++ b/feeds/luci/modules/luci-base/luasrc/view/cbi/apply_widget.htm	2018-07-07 19:49:15.541205548 +0800
@@ -164,7 +164,7 @@
 	function uci_apply(checked) {
 		uci_status_message('notice',
 			'<img src="<%=resource%>/icons/loading.gif" alt="" style="vertical-align:middle" /> ' +
-			'<%:Starting configuration apply…%>');
+			'<%:Starting configuration apply...%>');
 
 		xhr.post('<%=url("admin/uci")%>/' + (checked ? 'apply_rollback' : 'apply_unchecked'), uci_apply_auth, function(r) {
 			if (r.status === (checked ? 200 : 204)) {
--- a/feeds/packages/net/nginx/files-luci-support/luci_nginx.conf	2018-08-17 22:54:26.301096031 +0800
+++ b/feeds/packages/net/nginx/files-luci-support/luci_nginx.conf	2018-08-17 22:58:50.691792725 +0800
@@ -2,9 +2,9 @@
 user nobody nogroup;
 worker_processes  1;
 
-#error_log  logs/error.log;
-#error_log  logs/error.log  notice;
-#error_log  logs/error.log  info;
+#error_log  /tmp/log/nginx/error.log
+#error_log  /tmp/log/nginx/error.log  notice;
+#error_log  /tmp/log/nginx/error.log  info;
 
 pid        /var/run/nginx.pid;
 
@@ -52,4 +52,4 @@
 			
 		}
     }
-}
\ No newline at end of file
+}
--- a/feeds/luci/modules/luci-mod-network/luasrc/model/cbi/admin_network/wifi.lua	2018-08-17 22:49:10.465155312 +0800
+++ b/feeds/luci/modules/luci-mod-network/luasrc/model/cbi/admin_network/wifi.lua	2018-08-18 01:38:46.034778760 +0800
@@ -254,6 +254,16 @@
 	s:taboption("advanced", Flag, "noscan", translate("Force 40MHz mode"),
 		translate("Always use 40MHz channels even if the secondary channel overlaps. Using this option does not comply with IEEE 802.11n-2009!")).optional = true
 
+
+	log_level = s:taboption("advanced", ListValue, "log_level", translate("Logging Level"))
+	log_level.default = "2"
+	log_level.optional = true
+	log_level:value("2", translate("Informational Message"))
+	log_level:value("0", translate("Verbose Debugging"))
+	log_level:value("1", translate("Debugging"))
+	log_level:value("3", translate("Notification"))
+	log_level:value("4", translate("Warning"))
+
 	beacon_int = s:taboption("advanced", Value, "beacon_int", translate("Beacon Interval"))
 	beacon_int.optional = true
 	beacon_int.placeholder = 100
--- a/feeds/packages/net/uwsgi-cgi/files-luci-support/uwsgi.conf	2018-08-17 22:54:26.317105702 +0800
+++ b/feeds/packages/net/uwsgi-cgi/files-luci-support/uwsgi.conf	2018-08-18 13:17:17.158146420 +0800
@@ -8,7 +8,7 @@
 buffer-size	= 10000
 reload-mercy	= 8
 max-requests	= 2000
-limit-as	= 200
+limit-as	= 1000
 reload-on-as	= 256
 reload-on-rss	= 192
 no-orphans	= true
@@ -25,3 +25,6 @@
 threads		= 3
 processes	= 3
 chmod-socket	= 666
+ignore-sigpipe=True
+ignore-write-errors=True
+disable-write-exception=True
--- a/feeds/luci/applications/luci-app-samba4/luasrc/model/cbi/samba4.lua
+++ b/feeds/luci/applications/luci-app-samba4/luasrc/model/cbi/samba4.lua
@@ -75,6 +75,9 @@
 au = s:option(Value, "users", translate("Allowed users"))
 au.rmempty = true
 
+sp = s:option(Value, "sharepasswd", translate("Share Password"))
+sp.rmempty = true
+
 go = s:option(Flag, "guest_ok", translate("Allow guests"))
 go.enabled = "yes"
 go.disabled = "no"
--- a/feeds/packages/net/nginx/files-luci-support/luci_nginx_ssl.conf	2018-08-21 22:28:37.624512047 +0800
+++ b/feeds/packages/net/nginx/files-luci-support/luci_nginx_ssl.conf	2018-08-21 21:46:18.106683414 +0800
@@ -1,64 +1,91 @@
 
-user  root;
+user nobody nogroup;
 worker_processes  1;
 
-#error_log  logs/error.log;
-#error_log  logs/error.log  notice;
-#error_log  logs/error.log  info;
+#error_log  /tmp/log/nginx/error.log;
+#error_log  /tmp/log/nginx/error.log  notice;
+#error_log  /tmp/log/nginx/error.log  info;
 
-pid        /var/run/nginx.pid;
+pid  /var/run/nginx.pid;
 
 
 events {
-    worker_connections  1024;
+	worker_connections  1024;
 }
 
 
 http {
-    include       mime.types;
-    default_type  application/octet-stream;
+	include       mime.types;
+	default_type  application/octet-stream;
 
 	sendfile on;
-    keepalive_timeout 0;
+	keepalive_timeout 0;
 	
 	client_body_buffer_size 10K;
 	client_header_buffer_size 1k;
 	client_max_body_size 1G;
 	large_client_header_buffers 2 1k;
 
-    gzip on;
-    gzip_http_version 1.1;
-    gzip_vary on;
-    gzip_comp_level 1;
-    gzip_proxied any;
+	gzip on;
+	gzip_http_version 1.1;
+	gzip_vary on;
+	gzip_comp_level 1;
+	gzip_proxied any;
 	
 	root /www;
-	
+
 	server {
 		listen 80 default_server;
 		listen [::]:80 default_server;
-		server_name _;
-		return 301 https://$host$request_uri;
-	}
+		server_name  localhost;
+		
+		location ~ .*\.(css|js)?$ {
+			expires 15d;
+		}
+		location ~ .*\.(jpg|jpeg|gif|png|ico|woff|woff2|ttf|otf)?$ {
+			expires 365d;
+		}
+
+		location /web {
+			index  index.html;
+		}
+
+		location /webui-aria2 {
+			index  index.html;
+		}
+
+		include luci_uwsgi.conf;
 
-    server {
-        listen 443 ssl default_server;
+		#return 301 https://$host$request_uri;
+		
+	}
+	
+	server {
+		listen 443 ssl default_server;
 		listen [::]:443 ssl default_server;
-        server_name  localhost;
+		server_name  localhost;
 		
 		ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
-        ssl_prefer_server_ciphers on;
+		ssl_prefer_server_ciphers on;
 		ssl_ciphers "EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH:DHE+AESGCM:DHE:!RSA!aNULL:!eNULL:!LOW:!RC4:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS:!CAMELLIA:!SEED";
-        ssl_session_tickets off;
+		ssl_session_tickets off;
 
 		ssl_certificate /etc/nginx/nginx.cer;
-        ssl_certificate_key /etc/nginx/nginx.key;
+		ssl_certificate_key /etc/nginx/nginx.key;
 		
 		location ~* .(jpg|jpeg|png|gif|ico|css|js)$ {
 			expires 365d;
 		}
 
+		location /web {
+			index  index.html;
+		}
+
+		location /webui-aria2 {
+			index  index.html;
+		}
+		
 		include luci_uwsgi.conf;
 
-    }
-}
\ No newline at end of file
+	}
+}
--- a/feeds/luci/applications/luci-app-wifischedule/luasrc/model/cbi/wifischedule/wifi_schedule.lua	2018-05-14 16:33:04.467974565 +0800
+++ b/feeds/luci/applications/luci-app-wifischedule/luasrc/model/cbi/wifischedule/wifi_schedule.lua	2018-08-29 22:52:19.840332831 +0800
@@ -37,7 +37,8 @@
 
 -- BEGIN Map
 m = Map("wifi_schedule", translate("Wifi Schedule"), translate("Defines a schedule when to turn on and off wifi."))
-function m.on_commit(self)
+m.apply_on_parse=true
+function m.on_apply(self)
     sys.exec("/usr/bin/wifi_schedule.sh cron")
 end
 -- END Map
--- a/feeds/packages/net/wifischedule/net/usr/bin/wifi_schedule.sh	2018-01-18 17:47:24.308449537 +0800
+++ b/feeds/packages/net/wifischedule/net/usr/bin/wifi_schedule.sh	2018-08-29 22:53:39.324147677 +0800
@@ -305,7 +305,7 @@
 ###############################################################################
 LOGGING=$(_get_uci_value ${GLOBAL}.logging) || _exit 1
 _log ${SCRIPT} $1 $2
-lock ${LOCKFILE}
+#lock ${LOCKFILE}
 
 case "$1" in
     cron) check_cron_status ;;
--- a/feeds/packages/net/samba4/files/samba.init	2018-09-02 16:08:58.906441151 +0800
+++ b/feeds/packages/net/samba4/files/samba.init	2018-09-02 16:10:26.925264828 +0800
@@ -33,12 +33,15 @@
 	config_get_bool DISABLE_NETBIOS	$1 disable_netbios	0
 	config_get_bool DISABLE_AD_DC	$1 disable_ad_dc	0
 	config_get_bool DISABLE_WINBIND	$1 disable_winbind	0
+	local lan_ip=$(uci -q get network.lan.ipaddr)
+	[ -z "$lan_ip" ] && lan_ip=`ifconfig br-lan 2>/dev/null | grep "inet addr:" | grep -E -o "[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+"|head -1`
+
 
 	mkdir -p /var/etc
 	sed -e "s#|NAME|#$hostname#g" \
 	    -e "s#|WORKGROUP|#$workgroup#g" \
 	    -e "s#|DESCRIPTION|#$description#g" \
-	    -e "s#|INTERFACES|#$interfaces#g" \
+	    -e "s#|INTERFACES|#$lan_ip#g" \
 	    -e "s#|CHARSET|#$charset#g" \
 	    /etc/samba/smb.conf.template > /var/etc/smb.conf
 
@@ -94,6 +97,7 @@
 	config_get_bool timemachine	$1 timemachine	0
 	config_get timemachine_maxsize $1 timemachine_maxsize
 	config_get_bool force_root	$1 force_root	0
+	config_get sharepasswd $1 sharepasswd
 
 	[ -z "$name" -o -z "$path" ] && return
 
@@ -128,6 +132,26 @@
 	fi
 	
 	[ -n "$vfs_objects" ] && echo -e "\tvfs objects = $vfs_objects" >> /var/etc/smb.conf
+        if [ -n "$sharepasswd" ] && [ -n "$users" ] && [ "$users" = "root" ]; then
+                let sharepw_num+=1
+                sharepw=$sharepasswd
+        fi
+}
+
+set_sharepw() {
+	if [ "$sharepw_num" -gt 0 ]; then
+		[ -z "$(cat /etc/samba/smb.conf |grep "#invalid users = root")" ] && \
+			sed -i 's/invalid users = root/#invalid users = root/' /etc/samba/smb.conf
+                [ -z "$(cat /etc/samba/smb.conf.template |grep "#invalid users = root")" ] && \
+                        sed -i 's/invalid users = root/#invalid users = root/' /etc/samba/smb.conf.template
+                (echo $sharepw;echo $sharepw) | smbpasswd -as root
+        else
+                [ -n "$(cat /etc/samba/smb.conf |grep "#invalid users = root")" ] && \
+                        sed -i 's/#invalid users = root/invalid users = root/' /etc/samba/smb.conf
+                [ -n "$(cat /etc/samba/smb.conf.template |grep "#invalid users = root")" ] && \
+                        sed -i 's/#invalid users = root/invalid users = root/' /etc/samba/smb.conf.template
+                [ -n "$(cat /etc/samba/smbpasswd | grep root)" ] && smbpasswd -x root
+        fi
 }
 
 init_config() {
@@ -141,9 +165,13 @@
 		chmod 0755 /var/lock
 	}
 
+	local sharepw_num=0
+	local sharepw
+
 	config_load samba4
 	config_foreach smb_header samba
 	config_foreach smb_add_share sambashare
+	set_sharepw
 }
 
 service_triggers() {
--- a/feeds/luci/modules/luci-base/po/zh-cn/base.po	2018-09-02 18:20:47.209950947 +0800
+++ b/feeds/luci/modules/luci-base/po/zh-cn/base.po	2018-09-02 18:26:51.090088001 +0800
@@ -584,10 +584,10 @@
 msgstr "分类"
 
 msgid "Caution: Configuration files will be erased"
-msgstr ""
+msgstr "注意：配置文件将被删除。"
 
 msgid "Caution: System upgrade will be forced"
-msgstr ""
+msgstr "注意：系统将会强制升级。"
 
 msgid "Chain"
 msgstr "链"
@@ -688,8 +688,8 @@
 msgid "Configuration failed"
 msgstr "配置失败"
 
-msgid "Configuration files will be kept"
-msgstr ""
+msgid "Configuration files will be kept."
+msgstr "配置文件将被保留。"
 
 msgid "Configuration has been applied."
 msgstr "配置已应用。"
@@ -1462,7 +1462,7 @@
 msgstr "IP 地址"
 
 msgid "IP Protocol"
-msgstr ""
+msgstr "IP 协议"
 
 msgid "IP address"
 msgstr "IP 地址"
diff --git a/feeds/luci/modules/luci-base/luasrc/sys.lua b/feeds/luci/modules/luci-base/luasrc/sys.lua
index 823e20770c..49d8b6d256 100644
--- a/feeds/luci/modules/luci-base/luasrc/sys.lua
+++ b/feeds/luci/modules/luci-base/luasrc/sys.lua
@@ -340,6 +340,32 @@ function net.conntrack(callback)
 					if entry[key] == nil then
 						entry[key] = val
 					end
+					if entry["ptype"] == nil then
+						val = tonumber(val)
+						if key == "sport" then
+							if (val == 443) then
+								entry["ptype"] = "Https / SSL"
+							elseif val == 80 then
+								entry["ptype"] = "Http"
+							elseif val == 53 then
+								entry["ptype"] = "Dns"
+							elseif val == 22 then
+								entry["ptype"] = "SSH"
+							elseif val == 1900 then
+								entry["ptype"] = "UPnP"
+							elseif val == 123 then
+								entry["ptype"] = "NTP"
+							elseif val == 137 then
+								entry["ptype"] = "NetBIOS"
+							elseif val == 139 or val == 445 then
+								entry["ptype"] = "Samba"	
+							elseif val == 993 then
+								entry["ptype"] = "IMAP-SSL"
+							end
+						elseif (val >= 6902) and (val <= 6968) then
+								entry["ptype"] = "Torrent"
+						end
+					end
 				elseif val then
 					entry[key] = val
 				end
diff --git a/feeds/luci/modules/luci-mod-status/luasrc/view/admin_status/connections.htm b/feeds/luci/modules/luci-mod-status/luasrc/view/admin_status/connections.htm
index 0a0db3be78..abda40bbc3 100644
--- a/feeds/luci/modules/luci-mod-status/luasrc/view/admin_status/connections.htm
+++ b/feeds/luci/modules/luci-mod-status/luasrc/view/admin_status/connections.htm
@@ -131,15 +131,21 @@
 				}
 
 				label_scale.innerHTML = String.format('<%:(%d minute window, %d second interval)%>', data_wanted / 60, 3);
+				
+				var recheck_lookup_queue = {};
 
 				/* render datasets, start update interval */
 				XHR.poll(3, '<%=build_url("admin/status/realtime/connections_status")%>', null,
 					function(x, json)
 					{
-						var rows = [];
+
+						if (!json.connections)
+							return;
+
 						var conn = json.connections;
 
 						var lookup_queue = [ ];
+						var rows = [];
 
 						conn.sort(function(a, b) {
 							return b.bytes - a.bytes;
@@ -153,10 +159,10 @@
 							    (c.src == '::1'       && c.dst == '::1'))
 								continue;
 
-							if (!dns_cache[c.src])
+							if (!dns_cache[c.src] && lookup_queue.indexOf(c.src) == -1)
 								lookup_queue.push(c.src);
 
-							if (!dns_cache[c.dst])
+							if (!dns_cache[c.dst] && lookup_queue.indexOf(c.dst) == -1)
 								lookup_queue.push(c.dst);
 
 							var src = dns_cache[c.src] || (c.layer3 == 'ipv6' ? '[' + c.src + ']' : c.src);
@@ -165,22 +171,49 @@
 							rows.push([
 								c.layer3.toUpperCase(),
 								c.layer4.toUpperCase(),
-								src + ':' + c.sport,
-								dst + ':' + c.dport,
+								c.ptype,
+								[ src, c.sport ? ':' + c.sport : '' ],
+								[ dst, c.dport ? ':' + c.dport : '' ],
 								'%1024.2mB (%d <%:Pkts.%>)'.format(c.bytes, c.packets)
 							]);
 						}
 
 						cbi_update_table(conn_table, rows, '<em><%:No information available%></em>');
 
-						if (lookup_queue.length > 0)
-							XHR.get('<%=build_url("admin/status/nameinfo")%>/' + lookup_queue.slice(0, 100).join('/'), null,
-								function(x, json)
-								{
-									for (var addr in json)
-										dns_cache[addr] = json[addr];
+						if (lookup_queue.length > 0) {
+						  var reduced_lookup_queue = lookup_queue;
+						
+						  if (lookup_queue.length > 100)
+						  	reduced_lookup_queue = lookup_queue.slice(0, 100);							
+
+						  XHR.get('<%=build_url("admin/status/nameinfo")%>/' + reduced_lookup_queue.join('/'), null,
+						  	function(x, json)
+						  	{
+							  if (!json)
+								return;
+							
+							  for (var index in reduced_lookup_queue) {
+								var address = reduced_lookup_queue[index];
+								
+								if (!address)
+								  continue;
+								
+						  	    if (json[address]) {
+						  	      dns_cache[address] = json[address];
+						  	      lookup_queue.splice(reduced_lookup_queue.indexOf(address),1);
+								  continue;
 								}
-							);
+
+						  	    if(recheck_lookup_queue[address] > 2) {
+						  	      dns_cache[address] = (address.match(/:/)) ? '[' + address + ']' : address;
+						  	      lookup_queue.splice(index,1);
+						  	    } else {
+						  	      recheck_lookup_queue[address] != null ? recheck_lookup_queue[address]++ : recheck_lookup_queue[address] = 0;
+								}
+						  	  }
+						  	}
+						  );
+						}
 
 
 						var data = json.statistics;
@@ -359,6 +392,7 @@ <h2 name="content"><%:Realtime Connections%></h2>
 			<div class="tr table-titles">
 				<div class="th col-2 hide-xs"><%:Network%></div>
 				<div class="th col-2"><%:Protocol%></div>
+				<div class="th col-2"><%:Type%></div>
 				<div class="th col-7"><%:Source%></div>
 				<div class="th col-7"><%:Destination%></div>
 				<div class="th col-4"><%:Transfer%></div>
@@ -373,4 +407,4 @@ <h2 name="content"><%:Realtime Connections%></h2>
 	</div>
 </fieldset>
 
-<%+footer%>
+<%+footer%>
\ No newline at end of file
--- a/feeds/luci/modules/luci-mod-system/luasrc/view/admin_system/upgrade.htm	2018-10-01 00:06:34.669216800 +0800
+++ b/feeds/luci/modules/luci-mod-system/luasrc/view/admin_system/upgrade.htm	2018-10-01 00:05:18.129189021 +0800
@@ -39,13 +39,13 @@
 			end
 		%></li>
 		<li><% if keep then %>
-			<%:Configuration files will be kept%>
+			<%:Configuration files will be kept.%>
 		<% else %>
-			<%:Caution: Configuration files will be erased%>
+			<%:Caution: Configuration files will be erased.%>
 		<% end %></li>
 		<% if force then %>
 		<li>
-			<%:Caution: System upgrade will be forced%>
+			<%:Caution: System upgrade will be forced.%>
 		</li>
 		<% end %>
 	</ul>
--- a/feeds/luci/modules/luci-mod-system/luasrc/model/cbi/admin_system/admin.lua	2018-10-01 00:05:50.972932489 +0800
+++ b/feeds/luci/modules/luci-mod-system/luasrc/model/cbi/admin_system/admin.lua	2018-10-01 00:05:00.101474102 +0800
@@ -6,6 +6,7 @@
 
 m = Map("system", translate("Router Password"),
 	translate("Changes the administrator password for accessing the device"))
+m.apply_on_parse = true
 
 s = m:section(TypedSection, "_dummy", "")
 s.addremove = false
@@ -45,6 +46,7 @@
 
 m2 = Map("dropbear", translate("SSH Access"),
 	translate("Dropbear offers <abbr title=\"Secure Shell\">SSH</abbr> network shell access and an integrated <abbr title=\"Secure Copy\">SCP</abbr> server"))
+m2.apply_on_parse = true
 
 s = m2:section(TypedSection, "dropbear", translate("Dropbear Instance"))
 s.anonymous = true
